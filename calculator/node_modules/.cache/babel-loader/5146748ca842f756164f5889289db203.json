{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nconst initialState = {\n  ratesList: [],\n  addedRates: [],\n  totalPrice: 0,\n  status: null,\n  error: null,\n  discount: false,\n  discountAmount: 0\n};\nexport const fetchRates = createAsyncThunk(\"rates/fetchRates\", async function (_, _ref) {\n  let {\n    rejectWithValue\n  } = _ref;\n\n  try {\n    const response = axios.get(`http://localhost:3008/rates`);\n\n    if (response.ok) {\n      throw new Error(\"Server Error!\");\n    }\n\n    const data = await response;\n    return data.data;\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\nexport const ratesSlice = createSlice({\n  name: \"rates\",\n  initialState,\n  reducers: {\n    addRates: (state, _ref2) => {\n      var _state$addedRates;\n\n      let {\n        payload\n      } = _ref2;\n\n      /*const existingCategoryId = state.addedRates?.map((rate) => {\n        if (rate.category_name === payload.category_name) {\n          return rate.id;\n        }\n        return -1;\n      }); */\n      const existingCategoryId = (_state$addedRates = state.addedRates) === null || _state$addedRates === void 0 ? void 0 : _state$addedRates.filter(rate => rate.category_name === payload.category_name).map(rate => rate.id);\n      const exist = state.addedRates.some(rate => rate.category_name === payload.category_name && rate.category_name !== \"social\" && rate.category_name !== \"messenger\");\n\n      if (exist) {\n        //state.addedRates.splice(existingCategoryId, 1, payload);\n        state.addedRates[state.addedRates.findIndex(el => el.category_name === payload.category_name || el.id === payload.id)] = payload;\n      }\n\n      if (!exist) {\n        state.addedRates.push(payload);\n      }\n    },\n\n    updateAddedRates(state, _ref3) {\n      let {\n        payload\n      } = _ref3;\n      state.addedRates[state.addedRates.findIndex(el => el.id === payload.id)] = payload;\n    },\n\n    removeSelectedCheckbox(state, _ref4) {\n      let {\n        payload\n      } = _ref4;\n      state.addedRates = state.addedRates.filter(rate => rate.id !== payload);\n    },\n\n    calculateTotalPrice: state => {\n      var _state$addedRates2;\n\n      const discount = (_state$addedRates2 = state.addedRates) === null || _state$addedRates2 === void 0 ? void 0 : _state$addedRates2.some(rate => rate.category_name === \"internet\");\n      state.discount = discount;\n\n      if (state.addedRates.length === 0) {\n        state.totalPrice = 0;\n      }\n\n      if (state.addedRates.length === 1) {\n        var _state$addedRates$;\n\n        state.totalPrice = (_state$addedRates$ = state.addedRates[0]) === null || _state$addedRates$ === void 0 ? void 0 : _state$addedRates$.price;\n      }\n\n      if (state.addedRates.length >= 2) {\n        var _state$addedRates3;\n\n        let sum = (_state$addedRates3 = state.addedRates) === null || _state$addedRates3 === void 0 ? void 0 : _state$addedRates3.map(item => item === null || item === void 0 ? void 0 : item.price).reduce((acc, curr) => acc + curr);\n        let discAmount;\n\n        if (discount) {\n          var _state$addedRates4, _state$addedRates4$fi;\n\n          const discAmountCheck = (_state$addedRates4 = state.addedRates) === null || _state$addedRates4 === void 0 ? void 0 : (_state$addedRates4$fi = _state$addedRates4.filter(rate => rate.category_name === \"social\")) === null || _state$addedRates4$fi === void 0 ? void 0 : _state$addedRates4$fi.map(rate => rate === null || rate === void 0 ? void 0 : rate.price);\n          discAmount = discAmountCheck.length >= 2 ? discAmountCheck === null || discAmountCheck === void 0 ? void 0 : discAmountCheck.reduce((acc, curr) => acc + curr, 0) : discAmountCheck[0];\n          const newSumWithDiscount = sum - discAmount;\n          state.discountAmount = discAmount;\n          state.totalPrice = newSumWithDiscount;\n        }\n\n        state.totalPrice = sum;\n      }\n    }\n  },\n  extraReducers: {\n    [fetchRates.pending]: (state, action) => {\n      state.status = \"loading\";\n      state.error = null;\n    },\n    [fetchRates.fulfilled]: (state, action) => {\n      state.status = \"resolved\";\n      state.ratesList = action.payload;\n    },\n    [fetchRates.rejected]: (state, action) => {\n      state.status = \"rejected\";\n      state.error = action.payload;\n    }\n  }\n});\nexport const {\n  addRates,\n  calculateTotalPrice,\n  removeSelectedCheckbox\n} = ratesSlice.actions;\nexport default ratesSlice.reducer;","map":{"version":3,"sources":["/Users/anastasiaviva/projects/for-git/rates/calculator/src/store/slices/ratesSlice.js"],"names":["createSlice","createAsyncThunk","axios","initialState","ratesList","addedRates","totalPrice","status","error","discount","discountAmount","fetchRates","_","rejectWithValue","response","get","ok","Error","data","message","ratesSlice","name","reducers","addRates","state","payload","existingCategoryId","filter","rate","category_name","map","id","exist","some","findIndex","el","push","updateAddedRates","removeSelectedCheckbox","calculateTotalPrice","length","price","sum","item","reduce","acc","curr","discAmount","discAmountCheck","newSumWithDiscount","extraReducers","pending","action","fulfilled","rejected","actions","reducer"],"mappings":"AAAA,SAASA,WAAT,EAAsBC,gBAAtB,QAA8C,kBAA9C;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,SAAS,EAAE,EADQ;AAEnBC,EAAAA,UAAU,EAAE,EAFO;AAGnBC,EAAAA,UAAU,EAAE,CAHO;AAInBC,EAAAA,MAAM,EAAE,IAJW;AAKnBC,EAAAA,KAAK,EAAE,IALY;AAMnBC,EAAAA,QAAQ,EAAE,KANS;AAOnBC,EAAAA,cAAc,EAAE;AAPG,CAArB;AAUA,OAAO,MAAMC,UAAU,GAAGV,gBAAgB,CACxC,kBADwC,EAExC,gBAAgBW,CAAhB,QAAwC;AAAA,MAArB;AAAEC,IAAAA;AAAF,GAAqB;;AACtC,MAAI;AACF,UAAMC,QAAQ,GAAGZ,KAAK,CAACa,GAAN,CAAW,6BAAX,CAAjB;;AAEA,QAAID,QAAQ,CAACE,EAAb,EAAiB;AACf,YAAM,IAAIC,KAAJ,CAAU,eAAV,CAAN;AACD;;AAED,UAAMC,IAAI,GAAG,MAAMJ,QAAnB;AACA,WAAOI,IAAI,CAACA,IAAZ;AACD,GATD,CASE,OAAOV,KAAP,EAAc;AACd,WAAOK,eAAe,CAACL,KAAK,CAACW,OAAP,CAAtB;AACD;AACF,CAfuC,CAAnC;AAkBP,OAAO,MAAMC,UAAU,GAAGpB,WAAW,CAAC;AACpCqB,EAAAA,IAAI,EAAE,OAD8B;AAEpClB,EAAAA,YAFoC;AAGpCmB,EAAAA,QAAQ,EAAE;AACRC,IAAAA,QAAQ,EAAE,CAACC,KAAD,YAAwB;AAAA;;AAAA,UAAhB;AAAEC,QAAAA;AAAF,OAAgB;;AAChC;AACN;AACA;AACA;AACA;AACA;AACM,YAAMC,kBAAkB,wBAAGF,KAAK,CAACnB,UAAT,sDAAG,kBACvBsB,MADuB,CACfC,IAAD,IAAUA,IAAI,CAACC,aAAL,KAAuBJ,OAAO,CAACI,aADzB,EAExBC,GAFwB,CAEnBF,IAAD,IAAUA,IAAI,CAACG,EAFK,CAA3B;AAIA,YAAMC,KAAK,GAAGR,KAAK,CAACnB,UAAN,CAAiB4B,IAAjB,CACXL,IAAD,IACEA,IAAI,CAACC,aAAL,KAAuBJ,OAAO,CAACI,aAA/B,IACAD,IAAI,CAACC,aAAL,KAAuB,QADvB,IAEAD,IAAI,CAACC,aAAL,KAAuB,WAJb,CAAd;;AAOA,UAAIG,KAAJ,EAAW;AACT;AAEAR,QAAAA,KAAK,CAACnB,UAAN,CACEmB,KAAK,CAACnB,UAAN,CAAiB6B,SAAjB,CACGC,EAAD,IACEA,EAAE,CAACN,aAAH,KAAqBJ,OAAO,CAACI,aAA7B,IAA8CM,EAAE,CAACJ,EAAH,KAAUN,OAAO,CAACM,EAFpE,CADF,IAKIN,OALJ;AAMD;;AAED,UAAI,CAACO,KAAL,EAAY;AACVR,QAAAA,KAAK,CAACnB,UAAN,CAAiB+B,IAAjB,CAAsBX,OAAtB;AACD;AACF,KAjCO;;AAkCRY,IAAAA,gBAAgB,CAACb,KAAD,SAAqB;AAAA,UAAb;AAAEC,QAAAA;AAAF,OAAa;AACnCD,MAAAA,KAAK,CAACnB,UAAN,CACEmB,KAAK,CAACnB,UAAN,CAAiB6B,SAAjB,CAA4BC,EAAD,IAAQA,EAAE,CAACJ,EAAH,KAAUN,OAAO,CAACM,EAArD,CADF,IAEIN,OAFJ;AAGD,KAtCO;;AAuCRa,IAAAA,sBAAsB,CAACd,KAAD,SAAqB;AAAA,UAAb;AAAEC,QAAAA;AAAF,OAAa;AACzCD,MAAAA,KAAK,CAACnB,UAAN,GAAmBmB,KAAK,CAACnB,UAAN,CAAiBsB,MAAjB,CAAyBC,IAAD,IAAUA,IAAI,CAACG,EAAL,KAAYN,OAA9C,CAAnB;AACD,KAzCO;;AA0CRc,IAAAA,mBAAmB,EAAGf,KAAD,IAAW;AAAA;;AAC9B,YAAMf,QAAQ,yBAAGe,KAAK,CAACnB,UAAT,uDAAG,mBAAkB4B,IAAlB,CACdL,IAAD,IAAUA,IAAI,CAACC,aAAL,KAAuB,UADlB,CAAjB;AAIAL,MAAAA,KAAK,CAACf,QAAN,GAAiBA,QAAjB;;AAEA,UAAIe,KAAK,CAACnB,UAAN,CAAiBmC,MAAjB,KAA4B,CAAhC,EAAmC;AACjChB,QAAAA,KAAK,CAAClB,UAAN,GAAmB,CAAnB;AACD;;AACD,UAAIkB,KAAK,CAACnB,UAAN,CAAiBmC,MAAjB,KAA4B,CAAhC,EAAmC;AAAA;;AACjChB,QAAAA,KAAK,CAAClB,UAAN,yBAAmBkB,KAAK,CAACnB,UAAN,CAAiB,CAAjB,CAAnB,uDAAmB,mBAAqBoC,KAAxC;AACD;;AAED,UAAIjB,KAAK,CAACnB,UAAN,CAAiBmC,MAAjB,IAA2B,CAA/B,EAAkC;AAAA;;AAChC,YAAIE,GAAG,yBAAGlB,KAAK,CAACnB,UAAT,uDAAG,mBACNyB,GADM,CACDa,IAAD,IAAUA,IAAV,aAAUA,IAAV,uBAAUA,IAAI,CAAEF,KADd,EAEPG,MAFO,CAEA,CAACC,GAAD,EAAMC,IAAN,KAAeD,GAAG,GAAGC,IAFrB,CAAV;AAIA,YAAIC,UAAJ;;AAEA,YAAItC,QAAJ,EAAc;AAAA;;AACZ,gBAAMuC,eAAe,yBAAGxB,KAAK,CAACnB,UAAT,gFAAG,mBACpBsB,MADoB,CACZC,IAAD,IAAUA,IAAI,CAACC,aAAL,KAAuB,QADpB,CAAH,0DAAG,sBAEpBC,GAFoB,CAEfF,IAAD,IAAUA,IAAV,aAAUA,IAAV,uBAAUA,IAAI,CAAEa,KAFA,CAAxB;AAIAM,UAAAA,UAAU,GACRC,eAAe,CAACR,MAAhB,IAA0B,CAA1B,GACIQ,eADJ,aACIA,eADJ,uBACIA,eAAe,CAAEJ,MAAjB,CAAwB,CAACC,GAAD,EAAMC,IAAN,KAAeD,GAAG,GAAGC,IAA7C,EAAmD,CAAnD,CADJ,GAEIE,eAAe,CAAC,CAAD,CAHrB;AAKA,gBAAMC,kBAAkB,GAAGP,GAAG,GAAGK,UAAjC;AACAvB,UAAAA,KAAK,CAACd,cAAN,GAAuBqC,UAAvB;AACAvB,UAAAA,KAAK,CAAClB,UAAN,GAAmB2C,kBAAnB;AACD;;AACDzB,QAAAA,KAAK,CAAClB,UAAN,GAAmBoC,GAAnB;AACD;AACF;AA/EO,GAH0B;AAoFpCQ,EAAAA,aAAa,EAAE;AACb,KAACvC,UAAU,CAACwC,OAAZ,GAAsB,CAAC3B,KAAD,EAAQ4B,MAAR,KAAmB;AACvC5B,MAAAA,KAAK,CAACjB,MAAN,GAAe,SAAf;AACAiB,MAAAA,KAAK,CAAChB,KAAN,GAAc,IAAd;AACD,KAJY;AAKb,KAACG,UAAU,CAAC0C,SAAZ,GAAwB,CAAC7B,KAAD,EAAQ4B,MAAR,KAAmB;AACzC5B,MAAAA,KAAK,CAACjB,MAAN,GAAe,UAAf;AACAiB,MAAAA,KAAK,CAACpB,SAAN,GAAkBgD,MAAM,CAAC3B,OAAzB;AACD,KARY;AASb,KAACd,UAAU,CAAC2C,QAAZ,GAAuB,CAAC9B,KAAD,EAAQ4B,MAAR,KAAmB;AACxC5B,MAAAA,KAAK,CAACjB,MAAN,GAAe,UAAf;AACAiB,MAAAA,KAAK,CAAChB,KAAN,GAAc4C,MAAM,CAAC3B,OAArB;AACD;AAZY;AApFqB,CAAD,CAA9B;AAoGP,OAAO,MAAM;AAAEF,EAAAA,QAAF;AAAYgB,EAAAA,mBAAZ;AAAiCD,EAAAA;AAAjC,IACXlB,UAAU,CAACmC,OADN;AAGP,eAAenC,UAAU,CAACoC,OAA1B","sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\n\nconst initialState = {\n  ratesList: [],\n  addedRates: [],\n  totalPrice: 0,\n  status: null,\n  error: null,\n  discount: false,\n  discountAmount: 0,\n};\n\nexport const fetchRates = createAsyncThunk(\n  \"rates/fetchRates\",\n  async function (_, { rejectWithValue }) {\n    try {\n      const response = axios.get(`http://localhost:3008/rates`);\n\n      if (response.ok) {\n        throw new Error(\"Server Error!\");\n      }\n\n      const data = await response;\n      return data.data;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const ratesSlice = createSlice({\n  name: \"rates\",\n  initialState,\n  reducers: {\n    addRates: (state, { payload }) => {\n      /*const existingCategoryId = state.addedRates?.map((rate) => {\n        if (rate.category_name === payload.category_name) {\n          return rate.id;\n        }\n        return -1;\n      }); */\n      const existingCategoryId = state.addedRates\n        ?.filter((rate) => rate.category_name === payload.category_name)\n        .map((rate) => rate.id);\n\n      const exist = state.addedRates.some(\n        (rate) =>\n          rate.category_name === payload.category_name &&\n          rate.category_name !== \"social\" &&\n          rate.category_name !== \"messenger\"\n      );\n\n      if (exist) {\n        //state.addedRates.splice(existingCategoryId, 1, payload);\n\n        state.addedRates[\n          state.addedRates.findIndex(\n            (el) =>\n              el.category_name === payload.category_name || el.id === payload.id\n          )\n        ] = payload;\n      }\n\n      if (!exist) {\n        state.addedRates.push(payload);\n      }\n    },\n    updateAddedRates(state, { payload }) {\n      state.addedRates[\n        state.addedRates.findIndex((el) => el.id === payload.id)\n      ] = payload;\n    },\n    removeSelectedCheckbox(state, { payload }) {\n      state.addedRates = state.addedRates.filter((rate) => rate.id !== payload);\n    },\n    calculateTotalPrice: (state) => {\n      const discount = state.addedRates?.some(\n        (rate) => rate.category_name === \"internet\"\n      );\n\n      state.discount = discount;\n\n      if (state.addedRates.length === 0) {\n        state.totalPrice = 0;\n      }\n      if (state.addedRates.length === 1) {\n        state.totalPrice = state.addedRates[0]?.price;\n      }\n\n      if (state.addedRates.length >= 2) {\n        let sum = state.addedRates\n          ?.map((item) => item?.price)\n          .reduce((acc, curr) => acc + curr);\n\n        let discAmount;\n\n        if (discount) {\n          const discAmountCheck = state.addedRates\n            ?.filter((rate) => rate.category_name === \"social\")\n            ?.map((rate) => rate?.price);\n\n          discAmount =\n            discAmountCheck.length >= 2\n              ? discAmountCheck?.reduce((acc, curr) => acc + curr, 0)\n              : discAmountCheck[0];\n\n          const newSumWithDiscount = sum - discAmount;\n          state.discountAmount = discAmount;\n          state.totalPrice = newSumWithDiscount;\n        }\n        state.totalPrice = sum;\n      }\n    },\n  },\n  extraReducers: {\n    [fetchRates.pending]: (state, action) => {\n      state.status = \"loading\";\n      state.error = null;\n    },\n    [fetchRates.fulfilled]: (state, action) => {\n      state.status = \"resolved\";\n      state.ratesList = action.payload;\n    },\n    [fetchRates.rejected]: (state, action) => {\n      state.status = \"rejected\";\n      state.error = action.payload;\n    },\n  },\n});\n\nexport const { addRates, calculateTotalPrice, removeSelectedCheckbox } =\n  ratesSlice.actions;\n\nexport default ratesSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}