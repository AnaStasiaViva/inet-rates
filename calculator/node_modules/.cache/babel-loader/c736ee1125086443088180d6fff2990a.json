{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nconst initialState = {\n  ratesList: [],\n  addedRates: [],\n  totalPrice: 0,\n  status: null,\n  error: null,\n  discount: false,\n  discountAmount: 0\n};\nexport const fetchRates = createAsyncThunk(\"rates/fetchRates\", async function (_, _ref) {\n  let {\n    rejectWithValue\n  } = _ref;\n\n  try {\n    const response = axios.get(`http://localhost:3008/rates`);\n\n    if (response.ok) {\n      throw new Error(\"Server Error!\");\n    }\n\n    const data = await response;\n    return data.data;\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\n\nconst getCategoryItemId = (currentState, data) => {\n  return currentState === null || currentState === void 0 ? void 0 : currentState.filter(rate => rate.category_name === data.category_name).map(rate => rate.id);\n};\n\nconst checkIfItemWithSameCatExist = (currentState, data) => {\n  return currentState.some(rate => rate.category_name === data.category_name && rate.category_name !== \"social\" && rate.category_name !== \"messenger\");\n};\n\nexport const ratesSlice = createSlice({\n  name: \"rates\",\n  initialState,\n  reducers: {\n    addRates: (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n      const existingCategoryId = getCategoryItemId(state.addedRates, payload);\n      const exist = checkIfItemWithSameCatExist(state.addedRates, payload);\n\n      if (exist) {\n        state.addedRates[state.addedRates.findIndex(el => el.category_name === payload.category_name || el.id === payload.id)] = payload;\n      }\n\n      if (!exist) {\n        state.addedRates.push(payload);\n      }\n    },\n\n    updateAddedRates(state, _ref3) {\n      let {\n        payload\n      } = _ref3;\n      state.addedRates[state.addedRates.findIndex(el => el.id === payload.id)] = payload;\n    },\n\n    removeSelectedCheckbox(state, _ref4) {\n      let {\n        payload\n      } = _ref4;\n      state.addedRates = state.addedRates.filter(rate => rate.id !== payload);\n    },\n\n    calculateTotalPrice: state => {\n      var _state$addedRates;\n\n      const discount = (_state$addedRates = state.addedRates) === null || _state$addedRates === void 0 ? void 0 : _state$addedRates.some(rate => rate.category_name === \"internet\");\n      state.discount = discount;\n\n      if (state.addedRates.length === 0) {\n        state.totalPrice = 0;\n      }\n\n      if (state.addedRates.length === 1) {\n        var _state$addedRates$;\n\n        state.totalPrice = (_state$addedRates$ = state.addedRates[0]) === null || _state$addedRates$ === void 0 ? void 0 : _state$addedRates$.price;\n      }\n\n      if (state.addedRates.length >= 2) {\n        var _state$addedRates2;\n\n        let sum = (_state$addedRates2 = state.addedRates) === null || _state$addedRates2 === void 0 ? void 0 : _state$addedRates2.map(item => item === null || item === void 0 ? void 0 : item.price).reduce((acc, curr) => acc + curr);\n        let discAmount;\n\n        if (discount) {\n          var _state$addedRates3, _state$addedRates3$fi;\n\n          const discAmountCheck = (_state$addedRates3 = state.addedRates) === null || _state$addedRates3 === void 0 ? void 0 : (_state$addedRates3$fi = _state$addedRates3.filter(rate => rate.category_name === \"social\")) === null || _state$addedRates3$fi === void 0 ? void 0 : _state$addedRates3$fi.map(rate => rate === null || rate === void 0 ? void 0 : rate.price);\n          discAmount = discAmountCheck.length >= 2 ? discAmountCheck === null || discAmountCheck === void 0 ? void 0 : discAmountCheck.reduce((acc, curr) => acc + curr, 0) : discAmountCheck[0];\n          const newSumWithDiscount = sum - discAmount;\n          state.discountAmount = discAmount;\n          state.totalPrice = newSumWithDiscount;\n        }\n\n        state.totalPrice = sum;\n      }\n    }\n  },\n  extraReducers: {\n    [fetchRates.pending]: (state, action) => {\n      state.status = \"loading\";\n      state.error = null;\n    },\n    [fetchRates.fulfilled]: (state, action) => {\n      state.status = \"resolved\";\n      state.ratesList = action.payload;\n    },\n    [fetchRates.rejected]: (state, action) => {\n      state.status = \"rejected\";\n      state.error = action.payload;\n    }\n  }\n});\nexport const {\n  addRates,\n  calculateTotalPrice,\n  removeSelectedCheckbox\n} = ratesSlice.actions;\nexport default ratesSlice.reducer;\n/*const existingCategoryId = state.addedRates?.map((rate) => {\n        if (rate.category_name === payload.category_name) {\n          return rate.id;\n        }\n        return -1;\n      }); */\n//=======\n\n/* const existingCategoryId = state.addedRates\n        ?.filter((rate) => rate.category_name === payload.category_name)\n        .map((rate) => rate.id);\n        \n        const exist = state.addedRates.some(\n        (rate) =>\n          rate.category_name === payload.category_name &&\n          rate.category_name !== \"social\" &&\n          rate.category_name !== \"messenger\"\n      );\n        //state.addedRates.splice(existingCategoryId, 1, payload);\n        */","map":{"version":3,"sources":["/Users/anastasiaviva/projects/for-git/rates/calculator/src/store/slices/ratesSlice.js"],"names":["createSlice","createAsyncThunk","axios","initialState","ratesList","addedRates","totalPrice","status","error","discount","discountAmount","fetchRates","_","rejectWithValue","response","get","ok","Error","data","message","getCategoryItemId","currentState","filter","rate","category_name","map","id","checkIfItemWithSameCatExist","some","ratesSlice","name","reducers","addRates","state","payload","existingCategoryId","exist","findIndex","el","push","updateAddedRates","removeSelectedCheckbox","calculateTotalPrice","length","price","sum","item","reduce","acc","curr","discAmount","discAmountCheck","newSumWithDiscount","extraReducers","pending","action","fulfilled","rejected","actions","reducer"],"mappings":"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","sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\n\nconst initialState = {\n  ratesList: [],\n  addedRates: [],\n  totalPrice: 0,\n  status: null,\n  error: null,\n  discount: false,\n  discountAmount: 0,\n};\n\nexport const fetchRates = createAsyncThunk(\n  \"rates/fetchRates\",\n  async function (_, { rejectWithValue }) {\n    try {\n      const response = axios.get(`http://localhost:3008/rates`);\n\n      if (response.ok) {\n        throw new Error(\"Server Error!\");\n      }\n\n      const data = await response;\n      return data.data;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nconst getCategoryItemId = (currentState, data) => {\n  return currentState\n    ?.filter((rate) => rate.category_name === data.category_name)\n    .map((rate) => rate.id);\n};\n\nconst checkIfItemWithSameCatExist = (currentState, data) => {\n  return currentState.some(\n    (rate) =>\n      rate.category_name === data.category_name &&\n      rate.category_name !== \"social\" &&\n      rate.category_name !== \"messenger\"\n  );\n};\n\nexport const ratesSlice = createSlice({\n  name: \"rates\",\n  initialState,\n  reducers: {\n    addRates: (state, { payload }) => {\n      const existingCategoryId = getCategoryItemId(state.addedRates, payload);\n      const exist = checkIfItemWithSameCatExist(state.addedRates, payload);\n\n      if (exist) {\n        state.addedRates[\n          state.addedRates.findIndex(\n            (el) =>\n              el.category_name === payload.category_name || el.id === payload.id\n          )\n        ] = payload;\n      }\n\n      if (!exist) {\n        state.addedRates.push(payload);\n      }\n    },\n    updateAddedRates(state, { payload }) {\n      state.addedRates[\n        state.addedRates.findIndex((el) => el.id === payload.id)\n      ] = payload;\n    },\n    removeSelectedCheckbox(state, { payload }) {\n      state.addedRates = state.addedRates.filter((rate) => rate.id !== payload);\n    },\n    calculateTotalPrice: (state) => {\n      const discount = state.addedRates?.some(\n        (rate) => rate.category_name === \"internet\"\n      );\n\n      state.discount = discount;\n\n      if (state.addedRates.length === 0) {\n        state.totalPrice = 0;\n      }\n      if (state.addedRates.length === 1) {\n        state.totalPrice = state.addedRates[0]?.price;\n      }\n\n      if (state.addedRates.length >= 2) {\n        let sum = state.addedRates\n          ?.map((item) => item?.price)\n          .reduce((acc, curr) => acc + curr);\n\n        let discAmount;\n\n        if (discount) {\n          const discAmountCheck = state.addedRates\n            ?.filter((rate) => rate.category_name === \"social\")\n            ?.map((rate) => rate?.price);\n\n          discAmount =\n            discAmountCheck.length >= 2\n              ? discAmountCheck?.reduce((acc, curr) => acc + curr, 0)\n              : discAmountCheck[0];\n\n          const newSumWithDiscount = sum - discAmount;\n          state.discountAmount = discAmount;\n          state.totalPrice = newSumWithDiscount;\n        }\n        state.totalPrice = sum;\n      }\n    },\n  },\n  extraReducers: {\n    [fetchRates.pending]: (state, action) => {\n      state.status = \"loading\";\n      state.error = null;\n    },\n    [fetchRates.fulfilled]: (state, action) => {\n      state.status = \"resolved\";\n      state.ratesList = action.payload;\n    },\n    [fetchRates.rejected]: (state, action) => {\n      state.status = \"rejected\";\n      state.error = action.payload;\n    },\n  },\n});\n\nexport const { addRates, calculateTotalPrice, removeSelectedCheckbox } =\n  ratesSlice.actions;\n\nexport default ratesSlice.reducer;\n\n/*const existingCategoryId = state.addedRates?.map((rate) => {\n        if (rate.category_name === payload.category_name) {\n          return rate.id;\n        }\n        return -1;\n      }); */\n\n//=======\n\n/* const existingCategoryId = state.addedRates\n        ?.filter((rate) => rate.category_name === payload.category_name)\n        .map((rate) => rate.id);\n        \n        const exist = state.addedRates.some(\n        (rate) =>\n          rate.category_name === payload.category_name &&\n          rate.category_name !== \"social\" &&\n          rate.category_name !== \"messenger\"\n      );\n        //state.addedRates.splice(existingCategoryId, 1, payload);\n        */\n"]},"metadata":{},"sourceType":"module"}