{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nconst initialState = {\n  ratesList: [],\n  addedRates: [],\n  totalPrice: 0,\n  status: null,\n  error: null,\n  discount: false,\n  discountAmount: 0\n};\nexport const fetchRates = createAsyncThunk(\"rates/fetchRates\", async function (_, _ref) {\n  let {\n    rejectWithValue\n  } = _ref;\n\n  try {\n    const response = axios.get(`http://localhost:3008/rates`);\n\n    if (response.ok) {\n      throw new Error(\"Server Error!\");\n    }\n\n    const data = await response;\n    return data.data;\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\n\nconst getCategoryItemId = (currentState, data) => {\n  return currentState === null || currentState === void 0 ? void 0 : currentState.filter(rate => rate.category_name === data.category_name).map(rate => rate.id);\n};\n\nexport const ratesSlice = createSlice({\n  name: \"rates\",\n  initialState,\n  reducers: {\n    addRates: (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n\n      /*const existingCategoryId = state.addedRates?.map((rate) => {\n        if (rate.category_name === payload.category_name) {\n          return rate.id;\n        }\n        return -1;\n      }); */\n      //=======\n\n      /* const existingCategoryId = state.addedRates\n        ?.filter((rate) => rate.category_name === payload.category_name)\n        .map((rate) => rate.id);*/\n      const existingCategoryId = getCategoryItemId(state.addedRates, payload);\n      const exist = state.addedRates.some(rate => rate.category_name === payload.category_name && rate.category_name !== \"social\" && rate.category_name !== \"messenger\");\n\n      if (exist) {\n        //state.addedRates.splice(existingCategoryId, 1, payload);\n        state.addedRates[state.addedRates.findIndex(el => el.category_name === payload.category_name || el.id === payload.id)] = payload;\n      }\n\n      if (!exist) {\n        state.addedRates.push(payload);\n      }\n    },\n\n    updateAddedRates(state, _ref3) {\n      let {\n        payload\n      } = _ref3;\n      state.addedRates[state.addedRates.findIndex(el => el.id === payload.id)] = payload;\n    },\n\n    removeSelectedCheckbox(state, _ref4) {\n      let {\n        payload\n      } = _ref4;\n      state.addedRates = state.addedRates.filter(rate => rate.id !== payload);\n    },\n\n    calculateTotalPrice: state => {\n      var _state$addedRates;\n\n      const discount = (_state$addedRates = state.addedRates) === null || _state$addedRates === void 0 ? void 0 : _state$addedRates.some(rate => rate.category_name === \"internet\");\n      state.discount = discount;\n\n      if (state.addedRates.length === 0) {\n        state.totalPrice = 0;\n      }\n\n      if (state.addedRates.length === 1) {\n        var _state$addedRates$;\n\n        state.totalPrice = (_state$addedRates$ = state.addedRates[0]) === null || _state$addedRates$ === void 0 ? void 0 : _state$addedRates$.price;\n      }\n\n      if (state.addedRates.length >= 2) {\n        var _state$addedRates2;\n\n        let sum = (_state$addedRates2 = state.addedRates) === null || _state$addedRates2 === void 0 ? void 0 : _state$addedRates2.map(item => item === null || item === void 0 ? void 0 : item.price).reduce((acc, curr) => acc + curr);\n        let discAmount;\n\n        if (discount) {\n          var _state$addedRates3, _state$addedRates3$fi;\n\n          const discAmountCheck = (_state$addedRates3 = state.addedRates) === null || _state$addedRates3 === void 0 ? void 0 : (_state$addedRates3$fi = _state$addedRates3.filter(rate => rate.category_name === \"social\")) === null || _state$addedRates3$fi === void 0 ? void 0 : _state$addedRates3$fi.map(rate => rate === null || rate === void 0 ? void 0 : rate.price);\n          discAmount = discAmountCheck.length >= 2 ? discAmountCheck === null || discAmountCheck === void 0 ? void 0 : discAmountCheck.reduce((acc, curr) => acc + curr, 0) : discAmountCheck[0];\n          const newSumWithDiscount = sum - discAmount;\n          state.discountAmount = discAmount;\n          state.totalPrice = newSumWithDiscount;\n        }\n\n        state.totalPrice = sum;\n      }\n    }\n  },\n  extraReducers: {\n    [fetchRates.pending]: (state, action) => {\n      state.status = \"loading\";\n      state.error = null;\n    },\n    [fetchRates.fulfilled]: (state, action) => {\n      state.status = \"resolved\";\n      state.ratesList = action.payload;\n    },\n    [fetchRates.rejected]: (state, action) => {\n      state.status = \"rejected\";\n      state.error = action.payload;\n    }\n  }\n});\nexport const {\n  addRates,\n  calculateTotalPrice,\n  removeSelectedCheckbox\n} = ratesSlice.actions;\nexport default ratesSlice.reducer;","map":{"version":3,"sources":["/Users/anastasiaviva/projects/for-git/rates/calculator/src/store/slices/ratesSlice.js"],"names":["createSlice","createAsyncThunk","axios","initialState","ratesList","addedRates","totalPrice","status","error","discount","discountAmount","fetchRates","_","rejectWithValue","response","get","ok","Error","data","message","getCategoryItemId","currentState","filter","rate","category_name","map","id","ratesSlice","name","reducers","addRates","state","payload","existingCategoryId","exist","some","findIndex","el","push","updateAddedRates","removeSelectedCheckbox","calculateTotalPrice","length","price","sum","item","reduce","acc","curr","discAmount","discAmountCheck","newSumWithDiscount","extraReducers","pending","action","fulfilled","rejected","actions","reducer"],"mappings":"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","sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\n\nconst initialState = {\n  ratesList: [],\n  addedRates: [],\n  totalPrice: 0,\n  status: null,\n  error: null,\n  discount: false,\n  discountAmount: 0,\n};\n\nexport const fetchRates = createAsyncThunk(\n  \"rates/fetchRates\",\n  async function (_, { rejectWithValue }) {\n    try {\n      const response = axios.get(`http://localhost:3008/rates`);\n\n      if (response.ok) {\n        throw new Error(\"Server Error!\");\n      }\n\n      const data = await response;\n      return data.data;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nconst getCategoryItemId = (currentState, data) => {\n  return currentState\n    ?.filter((rate) => rate.category_name === data.category_name)\n    .map((rate) => rate.id);\n};\n\nexport const ratesSlice = createSlice({\n  name: \"rates\",\n  initialState,\n  reducers: {\n    addRates: (state, { payload }) => {\n      /*const existingCategoryId = state.addedRates?.map((rate) => {\n        if (rate.category_name === payload.category_name) {\n          return rate.id;\n        }\n        return -1;\n      }); */\n\n      //=======\n\n      /* const existingCategoryId = state.addedRates\n        ?.filter((rate) => rate.category_name === payload.category_name)\n        .map((rate) => rate.id);*/\n\n      const existingCategoryId = getCategoryItemId(state.addedRates, payload);\n\n      const exist = state.addedRates.some(\n        (rate) =>\n          rate.category_name === payload.category_name &&\n          rate.category_name !== \"social\" &&\n          rate.category_name !== \"messenger\"\n      );\n\n      if (exist) {\n        //state.addedRates.splice(existingCategoryId, 1, payload);\n\n        state.addedRates[\n          state.addedRates.findIndex(\n            (el) =>\n              el.category_name === payload.category_name || el.id === payload.id\n          )\n        ] = payload;\n      }\n\n      if (!exist) {\n        state.addedRates.push(payload);\n      }\n    },\n    updateAddedRates(state, { payload }) {\n      state.addedRates[\n        state.addedRates.findIndex((el) => el.id === payload.id)\n      ] = payload;\n    },\n    removeSelectedCheckbox(state, { payload }) {\n      state.addedRates = state.addedRates.filter((rate) => rate.id !== payload);\n    },\n    calculateTotalPrice: (state) => {\n      const discount = state.addedRates?.some(\n        (rate) => rate.category_name === \"internet\"\n      );\n\n      state.discount = discount;\n\n      if (state.addedRates.length === 0) {\n        state.totalPrice = 0;\n      }\n      if (state.addedRates.length === 1) {\n        state.totalPrice = state.addedRates[0]?.price;\n      }\n\n      if (state.addedRates.length >= 2) {\n        let sum = state.addedRates\n          ?.map((item) => item?.price)\n          .reduce((acc, curr) => acc + curr);\n\n        let discAmount;\n\n        if (discount) {\n          const discAmountCheck = state.addedRates\n            ?.filter((rate) => rate.category_name === \"social\")\n            ?.map((rate) => rate?.price);\n\n          discAmount =\n            discAmountCheck.length >= 2\n              ? discAmountCheck?.reduce((acc, curr) => acc + curr, 0)\n              : discAmountCheck[0];\n\n          const newSumWithDiscount = sum - discAmount;\n          state.discountAmount = discAmount;\n          state.totalPrice = newSumWithDiscount;\n        }\n        state.totalPrice = sum;\n      }\n    },\n  },\n  extraReducers: {\n    [fetchRates.pending]: (state, action) => {\n      state.status = \"loading\";\n      state.error = null;\n    },\n    [fetchRates.fulfilled]: (state, action) => {\n      state.status = \"resolved\";\n      state.ratesList = action.payload;\n    },\n    [fetchRates.rejected]: (state, action) => {\n      state.status = \"rejected\";\n      state.error = action.payload;\n    },\n  },\n});\n\nexport const { addRates, calculateTotalPrice, removeSelectedCheckbox } =\n  ratesSlice.actions;\n\nexport default ratesSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}